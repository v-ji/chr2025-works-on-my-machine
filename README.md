# â€œWorks on My Machineâ€ (CHR2025)

This repository contains the development environment and code for the paper [_â€œWorks on My Machineâ€: A Case Study of Replicability Challenges in Computational Humanities Research_](https://doi.org/10.63744/iAqEoznkfKuz).
The environment is managed with [Nix](https://nixos.org/) to ensure reproducibility.

## Overview

This project leverages Nix to define a reproducible development environment.
The analysis proceeds in two phases:

1. **Data Collection** (`get_papers.ipynb`): Downloads PDFs and generates an overview of papers with keyword matches.
2. **Analysis** (`evaluation.ipynb`): Analyses manually annotated data and produces tables and statistics.

## Repository Structure

```
.
â”œâ”€â”€ data/
â”‚   â””â”€â”€ papers_annotated.csv  # Manual annotations
â”œâ”€â”€ outputs/                  # All generated outputs (gitignored)
â”‚   â”œâ”€â”€ papers/               # PDFs and overview from get_papers.ipynb
â”‚   â””â”€â”€ tables/               # LaTeX tables from evaluation.ipynb
â”œâ”€â”€ get_papers.ipynb          # Step 1: PDF download and extraction
â”œâ”€â”€ evaluation.ipynb          # Step 2: Analysis of annotated data
â”œâ”€â”€ requirements.txt          # Python dependencies (generated by Nix)
â””â”€â”€ flake.nix                 # Nix environment definition
```

## Running the Analysis

1. **Data Collection**: Run `get_papers.ipynb` to download papers to `outputs/papers/` and generate the overview file.
2. **Manual Annotation**: Copy `outputs/papers/papers_overview.csv` to `data/papers_annotated.csv` and add manual annotations.
3. **Analysis**: Run `evaluation.ipynb` to generate tables and statistics in `outputs/tables/`.

## Setup Instructions

### Option 1: Using Nix â„ï¸ (Recommended)

Nix provides full reproducibility by managing all dependencies in a deterministic manner.

#### Building the Project

To build the project and execute all notebooks non-interactively:

```sh
$ nix build
```

The results will be stored in the Nix store and accessible via the `result` symlink.

You can also build directly from GitHub without cloning:

```sh
$ nix build github:v-ji/chr2025-works-on-my-machine
```

#### Development Environment

To work interactively with the notebooks:

```sh
$ nix develop
```

This enters a shell with all dependencies available. Start Jupyter with:

```sh
$ jupyter notebook
```

#### Pre-commit Script

The Nix development shell makes available a `pre-commit` command to perform clean-up tasks before committing.
Outside the dev shell, you may use:

```sh
$ nix develop --command pre-commit
```

This command:

- Clears all notebook cell outputs and metadata
- Regenerates `requirements.txt` from the Nix environment

### Option 2: Using Docker ðŸ³

For users without Nix, a pre-built OCI/Docker image is available for `x86_64-linux`.

> [!TIP]
> The image is OCI-compliant and works with both Docker and [Podman](https://podman.io/).
> Simply replace `docker` with `podman` in the commands below.

#### Building the Project

Download the image from the Releases section and run:

```sh
$ docker image load < chr2025-works-on-my-machine-env-1.0.0-x86_64-linux.tar.gz
$ docker run -it --rm --platform linux/amd64 chr2025-works-on-my-machine-env:1.0.0
```

Inside the container, build the project:

```sh
$ buildDerivation
```

Results will be available in the `$out` directory.

> [!NOTE]
> The image is built using Nix and contains minimal dependencies.  
> See the `dockerShell` output in `flake.nix` for the image definition.

#### Development Environment

To work interactively with notebooks in Docker:

```sh
$ docker run -it --rm -p 8888:8888 --platform linux/amd64 chr2025-works-on-my-machine:1.0.0
```

Inside the container, obtain a writeable source copy:

```sh
$ unpackPhase  # or run buildDerivation which also unpacks
```

Start Jupyter:

```sh
$ jupyter notebook *-source/ --no-browser --ip=0.0.0.0
```

Access the notebook at `http://localhost:8888` in your browser.

### Option 3: Using requirements.txt

A `requirements.txt` file is provided as a best-effort alternative for non-Nix users.
However, **using Nix is strongly recommended** for full reproducibility.

The pre-commit script generates this file automatically (see above).
You may also generate it manually by building the flakeâ€™s `requirements` package output:

```sh
$ nix build '.#requirements'
```

## License

This project is licensed under the MIT License. See the `LICENSE` file for details.
